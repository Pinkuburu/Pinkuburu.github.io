# 模拟弱网环境测试——工具篇

今年5G技术开始铺开并进入商用。随着5G的到来，不知道大家有没有和我一样的感受，希望是我心理作用吧，我发现作为一个4G用户，最近我的手机网速是不如从前了。特别是在游戏、或者是看一些重要直播的过程中，网络的卡顿延迟，真的让人大为光火。所以我想在最近分享一下，游戏测试需要怎么开展弱网测试，来尽量避免网络问题带给用户的不良体验。

作为移动端游戏测试，网络环境——尤其是弱网环境下——的测试环节其实是必不可少的。而手机上的网络制式类别很多：wifi、2G、3G、4G、5G，应用场景可能就更多了：办公室、街道、商场、地铁、车库等等。在这不同的场景、不同制式下，我们都可能遇到各式各样的断线、卡顿、延迟、数据同步异常等问题。所以，对于测试人员来说，我们面临的第一个难题就是网络环境的模拟。

今天我们先来介绍几个常见的弱网环境模拟工具。

首先是Fiddler。

大家都知道这是一个抓包工具。不过它也可以比较简单的作为一个弱网模拟工具来进行使用。我们可以通过Rules-Performance-Simulate Modem Speeds来对本地网络进行限速。

![img](https://pkbr.net/img/inpost/202107/20210726040216.jpeg)

但遗憾的是，这种设置比较粗暴，不能更改参数。所以我们还可以通过修改配置来定义其上下行流量的数值。设置方法在Rules-Customize Rules里面，找到下图中的这两行，就可以通过简单的方式来达到网络延迟的目的了。

![img](../img/inpost/202107/20210726%E5%BC%B1%E7%BD%91%E7%8E%AF%E5%A2%83%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/v2-a75be3401cfc5ba4b9e456b8412e5729_720w.jpg)

不过这毕竟不是一个专门用于弱网测试的工具，接下来介绍一个专门用作弱网模拟的工具，Clumsy。

Clumsy是基于C语言开发的一款开源网络模拟工具。它能在Windows平台下人工造成不稳定的网络状态，应用它可以方便调试应用程序在极端网络状态下的表现。

![img](https://pkbr.net/img/inpost/202107/20210726040248.jpeg)

如上图所示，这个工具基本分为3个区域：过滤器、预设条件和具体功能设置。在过滤器里，我们可以设置需要触发网络限制的基本规则。比如，设置输入（inbound）还是输出数据（outbound）、设置过滤tcp协议（tcp）还是udp协议（udp）、设置过滤地址（ip.DstAddr）等等。

另外我们可以把一些常用的测试条件，预先写到Clumsy的config.txt里面，然后在预设条件下拉框里快捷选择。

![img](https://pkbr.net/img/inpost/202107/20210726040254.jpeg)

填写完过滤条件后，点击start，就可以针对过滤条件范围内的数据进行网络限制了。除此以外，我们还可以利用具体功能设置，来设定特殊的限制规则，来进一步缩小测试范围。这些功能设置都是即时生效的，不需要重新stop-start。

目前对于Clumsy 0.2版本的功能有以下几种：

- 延迟(Lag)：把数据包缓存一段时间后再发出，这样能够模拟网络延迟的状况；
- 丢包(Drop)：随机丢弃一些数据；
- 截流(Throttle)：把一小段时间内的数据拦截下来后再在之后的同一时间一起发出去；
- 重发(Duplicate)：随机复制一些数据并与其本身一同发送；
- 乱序(Out of order)：打乱数据包发送的顺序；
- 篡改(Tamper)：随机修改小部分的包裹内容。

上面介绍的是一个Windows环境的测试工具，如果在手机上测试，我们必须要把手机和PC处在同一个网络环境里才能生效。那有什么比较便捷的手机app可以直接进行网络测试？这里介绍一个腾讯的QNET工具。这个app可以从wetest上面下载，安装后启动，我们可以看到主界面还是比较简单的，分为两部分，一个是选择程序，一个是设置测试条件。

![img](https://pkbr.net/img/inpost/202107/20210726040300.jpeg)

我们选择好需要测试的程序后，可以点击app里已经预设好的测试条件，点击右侧的修改按钮可以查看每项测试的具体规则。

![img](https://pkbr.net/img/inpost/202107/20210726040304.jpeg)

也可以自行新增配置，设定自己的测试规则，这一点上和Clumsy是一样的。

设置好之后，点击开始测试，就会自动启动被测程序，程序界面上会有浮窗，显示QNET记录的各项测试数据，方便我们进行工作。

![img](https://pkbr.net/img/inpost/202107/20210726040310.jpeg)

测试完成后，手动返回QNET，点击结束测试即可（这一点就不如wetest的性能工具方便，不能在浮窗上点击停止）。

以上就是我今天给大家分享的几个常用工具，也欢迎大家来交流一下自己工作里常用的网络测试工具~



欢迎大家交流、探讨，共同为游戏测试行业发力！